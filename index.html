<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ó–∞—è–≤–∫–∞ –Ω–∞ —Ä–æ–ª—å</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: var(--tg-theme-bg-color, #f4f0fa);
            --text-color: var(--tg-theme-text-color, #333);
            --primary-color: #8874a3;
            --primary-hover: #725d8f;
            --secondary-bg: var(--tg-theme-secondary-bg-color, #eadef0);
            --button-text: var(--tg-theme-button-text-color, #fff);
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 20px; overflow-x: hidden;
        }
        .screen { display: none; animation: fadeIn 0.3s ease-in-out; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        h1, h2 { text-align: center; color: var(--primary-color); }
        .rules-box {
            background-color: var(--secondary-bg); padding: 15px; border-radius: 16px;
            font-size: 14px; line-height: 1.5; max-height: 60vh; overflow-y: auto; margin-bottom: 20px;
        }
        input[type="text"] {
            width: 100%; padding: 15px; border: 2px solid var(--primary-color); border-radius: 16px;
            font-size: 16px; box-sizing: border-box; margin-bottom: 20px;
            background-color: var(--bg-color); color: var(--text-color); outline: none;
        }
        button {
            width: 100%; padding: 15px; background-color: var(--primary-color); color: var(--button-text);
            border: none; border-radius: 16px; font-size: 16px; font-weight: bold;
            cursor: pointer; margin-bottom: 10px; transition: background 0.2s;
        }
        button:active { background-color: var(--primary-hover); }
        .grid-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .category-card {
            background-color: var(--primary-color); color: var(--button-text); border-radius: 16px;
            padding: 15px; text-align: center; cursor: pointer; display: flex; flex-direction: column;
            align-items: center; justify-content: center; min-height: 100px; transition: transform 0.1s;
        }
        .category-card:active { transform: scale(0.95); }
        .image-placeholder { width: 60px; height: 60px; background-color: rgba(255, 255, 255, 0.2); border-radius: 12px; margin-bottom: 10px; }
        .char-item { background-color: var(--secondary-bg); padding: 15px; border-radius: 16px; margin-bottom: 10px; cursor: pointer; text-align: center; font-weight: 500; }
        .char-item:active { background-color: var(--primary-color); color: var(--button-text); }
    </style>
</head>
<body>
    <div id="screen-welcome" class="screen active">
        <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
        <p style="text-align: center;">–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ –Ω–∞—à —Ñ–ª—É–¥.</p>
        <button onclick="showScreen('screen-rules')">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
    </div>

    <div id="screen-rules" class="screen">
        <h2>–ü—Ä–∞–≤–∏–ª–∞ —Ñ–ª—É–¥–∞</h2>
        <div class="rules-box">
            <p><b>–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∫ –ø—Ä–æ—á—Ç–µ–Ω–∏—é:</b></p>
            <ul>
                <br><br><a href="https://t.me/pussuflood2">–ö–∞–Ω–∞–ª –§–ª—É–¥–∞</a></p>
                <li>–ö–∞–ª–ª –º–æ–≥—É—Ç –≤—ã–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—ã // –ø—Ä–µ–¥</li>
                <li>–ú–µ–Ω—è—Ç—å —Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º —á–∞—Å—Ç–æ –Ω–µ–ª—å–∑—è (—Ä–∞–∑ –≤ 2 –Ω–µ–¥–µ–ª–∏)</li>
                <li>–ù–æ—Ä–º—É –Ω—É–∂–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å, –µ—Å–ª–∏ –≤—ã –Ω–µ –Ω–∞–±–µ—Ä–µ—Ç–µ –Ω–æ—Ä–º—É –∏ –Ω–µ —Å–º–æ–∂–µ—Ç–µ –æ–ø—Ä–∞–≤–¥–∞—Ç—å —Å–µ–±—è, –≤—ã–ª–µ—Ç</li>
                <li>–°—Å–æ—Ä–∏—Ç—å—Å—è –∑–∞–ø—Ä–µ—â–µ–Ω–æ // –ø—Ä–µ–¥, –º—É—Ç –∏–ª–∏ –±–∞–Ω</li>
                <li>–û—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω—ã // –º—É—Ç –∏–ª–∏ –≤–∞—Ä–Ω. –í —ç—Ç—É –≥—Ä—É–ø–ø—É –≤—Ö–æ–¥—è—Ç –Ω–µ —Ç–æ–ª—å–∫–æ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è –Ω–∞ –æ–¥–Ω–æ –ª–∏—Ü–æ, –Ω–æ –∏ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã</li>
                <li>–û–±—Å—É–∂–¥–µ–Ω–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–º –∏–ª–∏ –æ—Å–∫–æ—Ä–±–∏—Ç–µ–ª—å–Ω–æ–º —Å–º—ã—Å–ª–µ // —Å–ª–æ–≤–µ—Å–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –º—É—Ç, –≤–∞—Ä–Ω –∏–ª–∏ –±–∞–Ω</li>
                <li>–ù–µ–ª—å–∑—è —Å–∫–∏–¥—ã–≤–∞—Ç—å —Ñ–æ—Ç–∫–∏ —à–æ–∫–∏—Ä—É—é—â–µ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è –∏ +18 // –±–∞–Ω</li>
                <li>–°–ø–∞–º (—Å–æ–æ–±—â–µ–Ω–∏–µ–º, —Ñ–æ—Ç–∫–æ–π, —Å—Ç–∏–∫–µ—Ä–∞–º) –ó–ê–ü–†–ï–©–ï–ù // –±–∞–Ω –∏–ª–∏ –º—É—Ç</li>
                <li>–ó–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ "@—é–∑" (–æ—Å–æ–±–µ–Ω–Ω–æ –≤ —Å—Ç–æ—Ä–æ–Ω—É –∞–¥–º–∏–Ω–æ–≤ –∏–ª–∏ –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤) // —Å–ª–æ–≤–µ—Å–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ -> –ø—Ä–µ–¥</li>
                <li>–ü–∏–∞—Ä –¥—Ä—É–≥–∏—Ö —Ä–æ–ª–µ–≤—ã—Ö/—Ñ–ª—É–¥–æ–≤ –∑–∞–ø—Ä–µ—â–µ–Ω // –ø—Ä–µ–¥ (–ï—Å–ª–∏ —Ü–µ–ª—å —Ç–æ–ª—å–∫–æ —Ä–µ–∫–ª–∞–º–∞ // –±–∞–Ω)</li>
                <li>–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –±—ã—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º–∏ –Ω–∞ –∏–Ω—Ñ–æ —Ç–≥–∫</li>
                <li>–ï—Å–ª–∏ –≤—ã –∑–∞—à–ª–∏ –≤ —Ñ–ª—É–¥ –±–æ–ª–µ–µ 4 –¥–Ω–µ–π –Ω–∞–∑–∞–¥, –Ω—É–∂–Ω–æ –Ω–∞–±—Ä–∞—Ç—å –Ω–æ—Ä–º—É</li>
                <li>–ï—Å–ª–∏ –≤—ã –Ω–µ –Ω–∞–±—Ä–∞–ª–∏ –Ω–æ—Ä–º—É, —É –≤–∞—Å –µ—Å—Ç—å —Ä–æ–≤–Ω–æ 24 —á–∞—Å–∞ —Å –º–æ–º–µ–Ω—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è —á–∏—Å—Ç–∫–∏ –¥–ª—è –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –ø—Ä–∏—á–∏–Ω—ã</li>
                <li>–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—Ç—å –æ —Ä–µ—Å—Ç–µ —Ö–æ—Ç—è –±—ã –∑–∞ 1-2 –¥–Ω—è –ø–µ—Ä–µ–¥ —á–∏—Å—Ç–∫–æ–π</li>
                <li>–ï—Å–ª–∏ –≤—ã –≤—ã—à–ª–∏ –∏–∑ —Ä–µ—Å—Ç–∞, —Ç–æ –≤ —Ç–µ—á–µ–Ω–∏–µ 4 –¥–Ω–µ–π –Ω–æ—Ä–º—É —É –≤–∞—Å –ø—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–µ –±—É–¥—É—Ç</li>
           </ul>
            <p><b>–í–∞–∂–Ω–æ–µ:</b> –í—Å–µ–≥–æ –º–∞–∫—Å–∏–º—É–º 4 –≤–∞—Ä–Ω–∞, –Ω–æ –Ω–∞ —Ç—Ä–µ—Ç–∏–π –≤–∞—Ä–Ω –ø—Ä–∏–±–∞–≤–ª—è–µ—Ç—Å—è —Å—Ä–∞–∑—É –¥–≤–∞ –∫ —Å—á–µ—Ç—á–∏–∫—É. –ñ–∞–ª–æ–±—ã –ø–æ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞ —Å –ø–æ–º–µ—Ç–∫–æ–π "–ñ–∞–ª–æ–±–∞" (–º–∞–∫—Å–∏–º—É–º —á–µ—Ä–µ–∑ 47 —á–∞—Å–æ–≤ –ø–æ—Å–ª–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è).</p>
            <p>–ö–æ–≥–¥–∞ –≤—ã—Ö–æ–¥–∏—Ç–µ, –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç–µ —Ä–æ–ª—å –∏ –ø—Ä–∏—á–∏–Ω—É!<br><br><a href="https://telegra.ph/Pravila-polnaya-versiya-300126-01-29" target="_blank">–ü–æ–ª–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Ç—É—Ç</a></p>
        </div>
        <button onclick="showScreen('screen-username')">–Ø –ø—Ä–æ—á–∏—Ç–∞–ª –∏ —Å–æ–≥–ª–∞—Å–µ–Ω</button>
    </div>

    <div id="screen-username" class="screen">
        <h2>–í–∞—à Telegram</h2>
        <p style="text-align: center;">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à @username –¥–ª—è —Å–≤—è–∑–∏ —Å –≤–∞–º–∏.</p>
        <input type="text" id="username-input" placeholder="@username" />
        <button onclick="saveUsername()">–î–∞–ª–µ–µ</button>
    </div>

    <div id="screen-category" class="screen">
        <h2>–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å</h2>
        <div class="grid-container" id="category-grid"></div>
        <button onclick="showScreen('screen-username')" style="margin-top: 20px; background-color: #ccc; color: #333;">–ù–∞–∑–∞–¥</button>
    </div>

    <div id="screen-character" class="screen">
        <h2 id="selected-category-title">–ü–µ—Ä—Å–æ–Ω–∞–∂–∏</h2>
        <div id="character-list"></div>
        <button onclick="showScreen('screen-category')" style="margin-top: 20px; background-color: #ccc; color: #333;">–ù–∞–∑–∞–¥ –∫ –∫–ª–∞—Å—Å–∞–º</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); 

        // –ß–∏—Ç–∞–µ–º –∑–∞–Ω—è—Ç—ã–µ —Ä–æ–ª–∏ –∏–∑ —É–º–Ω–æ–π —Å—Å—ã–ª–∫–∏, –∫–æ—Ç–æ—Ä—É—é –ø—Ä–∏—Å–ª–∞–ª –±–æ—Ç
        const urlParams = new URLSearchParams(window.location.search);
        const takenParam = urlParams.get('taken');
        let takenRoles = [];
        if(takenParam) {
            takenRoles = takenParam.split(',');
        }

        let userApp = { username: "", category: "", character: "" };

        const rolesData = {
            "WITCH": ["Dark Enchantress Cookie"],
            "BEAST": ["Burning Spice Cookie", "Eternal Sugar Cookie", "Silent Salt Cookie", "Mystic Flour Cookie", "Shadow milk Cookie"],
            "ANCIENT": ["White Lily Cookie", "Golden Cheese Cookie", "Dark Cacao Cookie", "Hollyberry Cookie", "Pure Vanilla Cookie"],
            "SPECIAL": ["Snapdragon Cookie", "Cream Ferret Cookie", "Icicle Yeti Cookie", "Marshmallow Bunny Cookie"],
            "DRAGON": ["Pitaya Dragon Cookie"],
            "LEGENDARY": ["Wind Archer Cookie", "Millennial Tree Cookie", "Stormbringer Cookie", "Moonlight Cookie", "Black Pearl Cookie", "Fire Spirit Cookie", "Sea Fairy Cookie", "Frost Queen Cookie"],
            "SUPER EPIC": ["Doughhael Cookie", "Camellia Cookie", "Elder Faerie Cookie", "Crimson Coral Cookie", "Shining Glitter Cookie", "Capsaicin Cookie", "Clotted Cream Cookie", "Oyster Cookie", "Sherbet Cookie", "Stardust Cookie", "Venom Dough Cookie"],
            "EPIC": ["Nutmeg Tiger Cookie", "Smoked Cheese Cookie", "Golden Osmanthus Cookie", "Choco Drizzle Cookie", "Pudding √† la Mode Cookie", "Green Tea Mousse Cookie", "Okchun Cookie", "Candy Apple Cookie", "Black Sapphire Cookie", "Red Osmanthus Cookie", "Street Urchin Cookie", "Cloud Haetae Cookie", "Peach Blossom Cookie", "Star Coral Cookie", "Caramel Choux Cookie", "Burnt Cheese Cookie", "Fettuccine Cookie", "Mozzarella Cookie", "Olive Cookie", "Linzer Cookie", "Cr√®me Br√ªl√©e Cookie", "Rebel Cookie", "Silverbell Cookie", "Mercurial Knight Cookie", "Matcha Cookie", "Butter Roll Cookie", "Prophet Cookie", "Milky Way Cookie", "Blueberry Pie Cookie", "Space Doughnut", "Prune Juice Cookie", "Kouign-Amann Cookie", "Royal Margarine Cookie", "Tarte Tatin Cookie", "Rockstar Cookie", "Black Lemonade Cookie", "Peppermint Cookie", "Frilled Jellyfish Cookie", "Cocoa Cookie", "Eclair Cookie", "Tea Knight Cookie", "Affogato Cookie", "Caramel Arrow Cookie", "Cherry Blossom Cookie", "Wildberry Cookie", "Crunchy Chip Cookie", "Financier Cookie", "Cream Unicorn Cookie", "Captain Caviar Cookie", "Candy Diver Cookie", "Schwarzw√§lder", "Macaron Cookie", "Carol Cookie", "Pinecone Cookie", "Black Raisin Cookie", "Strawberry Crepe Cookie", "Fig Cookie", "Pastry Cookie", "Red Velvet Cookie", "Mango Cookie", "Lilac Cookie", "Parfait Cookie", "Raspberry Cookie", "Moon Rabbit Cookie", "Mala Sauce Cookie", "Twizzly Gummy Cookie", "Pumpkin Pie Cookie", "Cotton Cookie", "Licorice Cookie", "Madeleine Cookie", "Espresso Cookie", "Rye Cookie", "Kumiho Cookie", "Latte Cookie", "Cream Puff Cookie", "Almond Cookie", "Werewolf Cookie", "Mint Choco Cookie", "Herb Cookie", "Dark Choco Cookie", "Sparkling Cookie", "Chili Pepper Cookie", "Pomegranate Cookie", "Purple Yam Cookie", "Milk Cookie", "Poison Mushroom Cookie", "Snow Sugar Cookie", "Vampire Cookie", "Tiger Lily Cookie", "Sorbet Shark Cookie", "Black Forest Cookie", "Squid Ink Cookie", "Agar Agar Cookie", "Wedding Cake Cookie", "Pavlova Cookie", "Sugarfly Cookie", "Cream Soda Cookie", "Lemon Cookie", "Orange Cookie", "Jagae Cookie", "Manju Cookie", "Lime Cookie", "Grapefruit Cookie", "Seltzer Cookie", "Menthol Cookie", "Charcoal Cookie", "Salt Cellar Cookie", "Chess Choco Cookie", "Mold Dough Cookie", "Pom Pom Dough"],
            "RARE": ["Princess Cookie", "Knight Cookie", "Cherry Cookie", "Alchemist Cookie", "Adventurer Cookie", "Blackberry Cookie", "Gumball Cookie", "Onion Cookie", "Pancake Cookie", "Avocado Cookie", "Carrot Cookie", "Clover Cookie", "Custard Cookie III", "Devil Cookie"],
            "COMMON": ["Beet Cookie", "Wizard Cookie", "Muscle Cookie", "Angel Cookie", "Ninja Cookie", "Strawberry Cookie", "GingerBrave"],
            "–î–†–£–ì–û–ï": ["–°–≤–æ—è —Ä–æ–ª—å..."]
        };

        if (tg.initDataUnsafe && tg.initDataUnsafe.user && tg.initDataUnsafe.user.username) {
            document.getElementById("username-input").value = "@" + tg.initDataUnsafe.user.username;
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function saveUsername() {
            let input = document.getElementById("username-input").value.trim();
            if (!input) { alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à @username!"); return; }
            userApp.username = input;
            buildCategories();
            showScreen('screen-category');
        }

        function buildCategories() {
            const grid = document.getElementById("category-grid");
            grid.innerHTML = ""; 
            for (let cat in rolesData) {
                let card = document.createElement("div");
                card.className = "category-card";
                card.onclick = () => selectCategory(cat);
                card.innerHTML = `<div class="image-placeholder"></div><div>${cat}</div>`;
                grid.appendChild(card);
            }
        }

        function selectCategory(cat) {
            userApp.category = cat;
            document.getElementById("selected-category-title").innerText = cat;
            const list = document.getElementById("character-list");
            list.innerHTML = "";

            let count = 0;
            rolesData[cat].forEach(char => {
                // –ï—Å–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂ —É–∂–µ –∑–∞–Ω—è—Ç - –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ!
                if (!takenRoles.includes(char)) {
                    let item = document.createElement("div");
                    item.className = "char-item";
                    item.innerText = char;
                    item.onclick = () => submitApplication(char);
                    list.appendChild(item);
                    count++;
                }
            });

            if (count === 0) {
                list.innerHTML = "<p style='text-align:center;'>–í—Å–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏ –≤ —ç—Ç–æ–º –∫–ª–∞—Å—Å–µ –∑–∞–Ω—è—Ç—ã üò¢</p>";
            }
            showScreen('screen-character');
        }

        function submitApplication(character) {
            userApp.character = character;
            let finalData = JSON.stringify({ action: "new_app", username: userApp.username, category: userApp.category, role: userApp.character });
            tg.sendData(finalData);
            tg.close();
        }
    </script>
</body>
</html>
